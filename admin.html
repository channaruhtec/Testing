<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gem Cabinet - Admin</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'gem-dark': '#0f172a',
                        'gem-darker': '#020617',
                        'gem-gold': '#d4af37',
                        'gem-accent': '#1e293b',
                    },
                    fontFamily: {
                        serif: ['Playfair Display', 'serif'],
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;600&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        h1,
        h2,
        h3 {
            font-family: 'Playfair Display', serif;
        }
    </style>
</head>

<body class="bg-gem-darker text-gray-200">

    <!-- Login Overlay -->
    <div id="login-overlay" class="fixed inset-0 bg-gem-darker z-50 flex items-center justify-center">
        <div class="bg-gem-dark p-8 rounded-lg shadow-2xl border border-gem-gold/20 max-w-sm w-full">
            <h2 class="text-2xl text-gem-gold mb-6 text-center">Admin Access</h2>
            <input type="password" id="password-input" placeholder="Enter Password"
                class="w-full bg-gem-accent border border-gray-700 rounded p-3 text-white mb-4 focus:border-gem-gold outline-none">
            <button onclick="checkLogin()"
                class="w-full bg-gem-gold text-gem-darker font-bold py-3 rounded hover:bg-yellow-500 transition-colors">
                Login
            </button>
            <p id="login-error" class="text-red-500 text-sm mt-3 text-center hidden">Incorrect password</p>
        </div>
    </div>

    <!-- Main Admin Dashboard -->
    <div id="dashboard" class="hidden min-h-screen p-6">
        <header class="flex justify-between items-center mb-8 border-b border-gray-800 pb-4">
            <h1 class="text-3xl text-gem-gold">Gem Inventory Manager</h1>
            <div class="flex gap-4">
                <button onclick="exportData()"
                    class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded flex items-center gap-2 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
                            clip-rule="evenodd" />
                    </svg>
                    Export Code
                </button>
                <a href="index.html" target="_blank"
                    class="bg-gem-accent hover:bg-gray-700 text-gray-300 px-4 py-2 rounded transition-colors">
                    View Site
                </a>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Form Section -->
            <div class="lg:col-span-1">
                <div class="bg-gem-dark p-6 rounded-lg border border-gem-accent sticky top-6">
                    <h2 class="text-xl text-white mb-4" id="form-title">Add New Gem</h2>
                    <form id="gem-form" onsubmit="handleFormSubmit(event)">
                        <input type="hidden" id="gem-id">

                        <div class="grid gap-4">
                            <div>
                                <label class="block text-gray-400 text-sm mb-1">Name</label>
                                <input type="text" id="gem-name" required
                                    class="w-full bg-gem-accent border border-gray-700 rounded p-2 text-white focus:border-gem-gold outline-none">
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-400 text-sm mb-1">Type</label>
                                    <input type="text" id="gem-type" required
                                        class="w-full bg-gem-accent border border-gray-700 rounded p-2 text-white focus:border-gem-gold outline-none">
                                </div>
                                <div>
                                    <label class="block text-gray-400 text-sm mb-1">Weight (ct)</label>
                                    <input type="number" step="0.01" id="gem-weight" required
                                        class="w-full bg-gem-accent border border-gray-700 rounded p-2 text-white focus:border-gem-gold outline-none">
                                </div>
                            </div>

                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-400 text-sm mb-1">Color</label>
                                    <input type="text" id="gem-color"
                                        class="w-full bg-gem-accent border border-gray-700 rounded p-2 text-white focus:border-gem-gold outline-none">
                                </div>
                                <div>
                                    <label class="block text-gray-400 text-sm mb-1">Origin</label>
                                    <input type="text" id="gem-origin"
                                        class="w-full bg-gem-accent border border-gray-700 rounded p-2 text-white focus:border-gem-gold outline-none">
                                </div>
                            </div>

                            <div>
                                <label class="block text-gray-400 text-sm mb-1">Price ($)</label>
                                <input type="number" id="gem-price" required
                                    class="w-full bg-gem-accent border border-gray-700 rounded p-2 text-white focus:border-gem-gold outline-none">
                            </div>

                            <div>
                                <label class="block text-gray-400 text-sm mb-1">Image Filename / URL</label>
                                <input type="text" id="gem-image" required placeholder="e.g., blue-sapphire.jpg"
                                    class="w-full bg-gem-accent border border-gray-700 rounded p-2 text-white focus:border-gem-gold outline-none">
                                <p class="text-xs text-gray-500 mt-1">Make sure the file is uploaded to the root folder.
                                </p>
                            </div>

                            <button type="submit" id="submit-btn"
                                class="w-full bg-gem-gold text-gem-darker font-bold py-2 rounded hover:bg-yellow-500 transition-colors mt-2">
                                Add Gem
                            </button>
                            <button type="button" onclick="resetForm()" id="cancel-btn"
                                class="w-full bg-transparent border border-gray-600 text-gray-400 font-bold py-2 rounded hover:text-white transition-colors hidden">
                                Cancel Edit
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- List Section -->
            <div class="lg:col-span-2">
                <div class="bg-gem-dark rounded-lg border border-gem-accent overflow-hidden">
                    <table class="w-full text-left text-sm">
                        <thead class="bg-gem-accent text-gray-400 uppercase">
                            <tr>
                                <th class="p-4">Image</th>
                                <th class="p-4">Details</th>
                                <th class="p-4">Price</th>
                                <th class="p-4 text-right">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="gem-table-body" class="divide-y divide-gray-800">
                            <!-- Rows generated by JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="toast"
        class="fixed bottom-4 right-4 bg-green-600 text-white px-6 py-3 rounded shadow-lg transform translate-y-20 opacity-0 transition-all duration-300">
        Message
    </div>

    <!-- Load Data -->
    <script src="js/gems.js"></script>

    <script>
        // --- Admin Logic ---

        // 1. Authentication
        function checkLogin() {
            const pass = document.getElementById('password-input').value;
            // Simple client-side check. CHANGE THIS if you want real security (requires backend).
            if (pass === 'gemadmin123') {
                document.getElementById('login-overlay').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                initDashboard();
            } else {
                document.getElementById('login-error').classList.remove('hidden');
            }
        }

        // Allow 'Enter' key to login
        document.getElementById('password-input').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') checkLogin();
        });

        // 2. State Management
        let inventory = [];

        function initDashboard() {
            // Load gems from the imported file (global 'gems' variable)
            // Clone it to avoid modifying the read-only reference if necessary (though simple arrays are mutable)
            inventory = [...gems];
            renderTable();
        }

        // 3. Render Table
        function renderTable() {
            const tbody = document.getElementById('gem-table-body');
            tbody.innerHTML = '';

            inventory.forEach(gem => {
                const tr = document.createElement('tr');
                tr.className = 'hover:bg-gem-accent/50 transition-colors';

                tr.innerHTML = `
                    <td class="p-4">
                        <img src="${gem.image}" alt="${gem.name}" class="h-12 w-12 object-cover rounded bg-gray-800">
                    </td>
                    <td class="p-4">
                        <div class="font-bold text-white">${gem.name}</div>
                        <div class="text-gray-400 text-xs">${gem.weight} ct | ${gem.type}</div>
                    </td>
                    <td class="p-4 text-gem-gold font-bold">
                        $${gem.price.toLocaleString()}
                    </td>
                    <td class="p-4 text-right space-x-2">
                        <button onclick="editGem(${gem.id})" class="text-blue-400 hover:text-blue-300">Edit</button>
                        <button onclick="deleteGem(${gem.id})" class="text-red-400 hover:text-red-300">Delete</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // 4. Form Handling
        function handleFormSubmit(e) {
            e.preventDefault();

            const idInput = document.getElementById('gem-id').value;
            const isEdit = idInput !== '';

            const newGem = {
                id: isEdit ? parseInt(idInput) : Date.now(), // Generate rough ID for new items
                name: document.getElementById('gem-name').value,
                type: document.getElementById('gem-type').value,
                weight: parseFloat(document.getElementById('gem-weight').value),
                color: document.getElementById('gem-color').value,
                origin: document.getElementById('gem-origin').value,
                price: parseFloat(document.getElementById('gem-price').value),
                image: document.getElementById('gem-image').value
            };

            if (isEdit) {
                const index = inventory.findIndex(g => g.id === parseInt(idInput));
                if (index !== -1) {
                    inventory[index] = newGem;
                    showToast('Gem Updated Successfully');
                }
            } else {
                inventory.push(newGem);
                showToast('New Gem Added');
            }

            renderTable();
            resetForm();
        }

        function editGem(id) {
            const gem = inventory.find(g => g.id === id);
            if (!gem) return;

            document.getElementById('gem-id').value = gem.id;
            document.getElementById('gem-name').value = gem.name;
            document.getElementById('gem-type').value = gem.type;
            document.getElementById('gem-weight').value = gem.weight;
            document.getElementById('gem-color').value = gem.color || '';
            document.getElementById('gem-origin').value = gem.origin || '';
            document.getElementById('gem-price').value = gem.price;
            document.getElementById('gem-image').value = gem.image;

            document.getElementById('form-title').textContent = 'Edit Gem';
            document.getElementById('submit-btn').textContent = 'Update Gem';
            document.getElementById('cancel-btn').classList.remove('hidden');
        }

        function deleteGem(id) {
            if (confirm('Are you sure you want to delete this gem?')) {
                inventory = inventory.filter(g => g.id !== id);
                renderTable();
                showToast('Gem Deleted');
            }
        }

        function resetForm() {
            document.getElementById('gem-form').reset();
            document.getElementById('gem-id').value = '';
            document.getElementById('form-title').textContent = 'Add New Gem';
            document.getElementById('submit-btn').textContent = 'Add Gem';
            document.getElementById('cancel-btn').classList.add('hidden');
        }

        // 5. Export Logic
        function exportData() {
            // Convert inventory array to formatted JSON-like string
            // We use JSON.stringify but then adjust it to look like a variable declaration
            const json = JSON.stringify(inventory, null, 4);
            const jsCode = `// Master Gemstone Data\nconst gems = ${json};\n`;

            // Copy to clipboard
            navigator.clipboard.writeText(jsCode).then(() => {
                showToast('Code Copied to Clipboard!');
                alert('Code copied! Now paste it into js/gems.js replacing the old content.');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy automatically. Please copy the code manually from console.');
                console.log(jsCode);
            });
        }

        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.textContent = msg;
            toast.classList.remove('opacity-0', 'translate-y-20');
            setTimeout(() => {
                toast.classList.add('opacity-0', 'translate-y-20');
            }, 3000);
        }
    </script>
</body>

</html>