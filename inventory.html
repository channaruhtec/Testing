<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory | Gem Cabinet</title>
    <meta name="description"
        content="Browse our exclusive collection of rough sapphires, spinels, and garnets from Sri Lanka.">
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;500;600&display=swap"
        rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        gem: {
                            dark: '#0f172a', // Slate 900
                            darker: '#020617', // Slate 950
                            gold: '#d4af37', // Metallic Gold
                            goldHover: '#b8962e',
                            accent: '#1e293b', // Slate 800
                        },
                        fontFamily: {
                            serif: ['"Playfair Display"', 'serif'],
                            sans: ['Inter', 'sans-serif'],
                        }
                    }
                }
            }
        }
    </script>

    <style>
        /* Custom Scrollbar for dark theme */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #0f172a;
        }

        ::-webkit-scrollbar-thumb {
            background: #334155;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #475569;
        }

        /* Gold text gradient effect for some headlines */
        .text-gradient-gold {
            background: linear-gradient(to right, #fcd34d, #d4af37, #f59e0b);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>

<body class="bg-gem-darker text-gray-200 font-sans antialiased selection:bg-gem-gold selection:text-gem-darker">

    <!-- Navbar -->
    <nav class="fixed w-full z-50 top-0 left-0 bg-gem-dark/95 backdrop-blur-md border-b border-gem-accent transition-all duration-300"
        id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20 lg:h-24">
                <!-- Logo -->
                <div class="flex-shrink-0 flex items-center">
                    <a href="index.html" class="flex flex-col items-start group">
                        <span
                            class="font-serif text-2xl lg:text-3xl font-bold tracking-widest text-transparent bg-clip-text bg-gradient-to-r from-gem-gold via-yellow-200 to-gem-gold filter drop-shadow-sm">
                            GEM CABINET
                        </span>
                        <span
                            class="text-[0.6rem] text-gray-400 uppercase tracking-[0.3em] font-sans group-hover:text-white transition-colors">
                            from the mines of gemcity
                        </span>
                    </a>
                </div>

                <!-- Desktop Menu -->
                <div class="hidden md:block">
                    <div
                        class="flex items-center space-x-6 lg:space-x-10 text-[10px] lg:text-xs uppercase tracking-[0.2em] font-medium">
                        <a href="index.html" class="text-gray-400 hover:text-gem-gold transition-colors">Home</a>
                        <a href="inventory.html" class="text-gem-gold">Inventory</a>
                        <a href="track.html" class="text-gray-400 hover:text-gem-gold transition-colors">Track Order</a>
                        <a href="feedback.html" class="text-gray-400 hover:text-gem-gold transition-colors">Feedback</a>
                        <a href="contact.html"
                            class="bg-gem-gold text-gem-darker hover:bg-white hover:text-gem-darker px-5 py-2 rounded-full text-sm font-bold transition-all transform hover:scale-105 shadow-lg shadow-gem-gold/20 mr-4">Contact</a>

                        <!-- Auth Nav -->
                        <div class="auth-nav flex items-center mr-4 border-r border-gray-800 pr-4">
                            <a href="login.html"
                                class="text-gray-400 hover:text-gem-gold transition-colors font-medium">Sign In</a>
                        </div>

                        <!-- Cart Icon -->
                        <button onclick="openCart()"
                            class="relative p-2 text-gray-400 hover:text-gem-gold transition-colors focus:outline-none group/cart">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                                stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                    d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                            </svg>
                            <span
                                class="cart-count absolute -top-1 -right-1 bg-gem-gold text-gem-darker text-[10px] font-bold px-1.5 py-0.5 rounded-full hidden">0</span>
                        </button>
                    </div>
                </div>

                <!-- Mobile Menu Button & Cart -->
                <div class="-mr-2 flex items-center md:hidden gap-2">
                    <!-- Mobile Cart Icon -->
                    <button onclick="openCart()"
                        class="relative p-2 text-gray-400 hover:text-gem-gold transition-colors focus:outline-none">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                        </svg>
                        <span
                            class="cart-count absolute -top-1 -right-1 bg-gem-gold text-gem-darker text-[10px] font-bold px-1.5 py-0.5 rounded-full hidden">0</span>
                    </button>

                    <button type="button"
                        class="inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-white hover:bg-gem-accent focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white"
                        aria-controls="mobile-menu" aria-expanded="false"
                        onclick="document.getElementById('mobile-menu').classList.toggle('hidden')">
                        <span class="sr-only">Open main menu</span>
                        <svg class="block h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                            stroke="currentColor" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 6h16M4 12h16M4 18h16" />
                        </svg>
                    </button>
                </div>

            </div>
        </div>

        <!-- Mobile Menu -->
        <div class="hidden md:hidden bg-gem-dark border-t border-gem-accent" id="mobile-menu">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="index.html"
                    class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Home</a>
                <a href="inventory.html"
                    class="text-white font-bold block px-3 py-2 rounded-md text-base font-medium">Inventory</a>
                <a href="track.html"
                    class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Track
                    Order</a>
                <a href="feedback.html"
                    class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Feedback</a>
                <a href="about.html"
                    class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">About</a>
                <a href="contact.html"
                    class="text-gray-300 hover:text-white block px-3 py-2 rounded-md text-base font-medium">Contact</a>

                <!-- Mobile Auth Nav -->
                <div id="mobile-auth-nav"></div>
            </div>
    </nav>

    <!-- Checkout Modal -->
    <div id="checkout-modal"
        class="fixed inset-0 z-[100] hidden items-center justify-center p-4 bg-black/90 backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <div class="bg-gem-dark w-full max-w-lg border border-gem-accent p-8 relative">
            <button onclick="closeCheckout()"
                class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>

            <div id="checkout-form-container">
                <form id="checkout-form" onsubmit="handleCheckout(event)" class="space-y-6">
                    <div class="text-center mb-6">
                        <h2 class="text-2xl font-serif text-white mb-2">Secure Checkout</h2>
                        <div id="checkout-items-summary"
                            class="bg-gem-darker border border-gem-accent p-3 rounded-sm space-y-2 max-h-32 overflow-y-auto mb-4 hidden">
                            <!-- Items listed here -->
                        </div>
                        <p id="checkout-single-info" class="text-gray-400 text-sm">Completing purchase for <span
                                id="checkout-gem-name" class="text-gem-gold font-bold">...</span></p>
                    </div>

                    <div class="grid grid-cols-1 gap-4">
                        <div>
                            <label class="block text-gray-400 text-[10px] uppercase tracking-widest mb-1">Full
                                Name</label>
                            <input type="text" id="cust-name" required
                                class="w-full bg-gem-accent border border-gray-700 rounded-sm p-3 text-white focus:outline-none focus:border-gem-gold transition-colors">
                        </div>
                        <div>
                            <label class="block text-gray-400 text-[10px] uppercase tracking-widest mb-1">Email
                                Address</label>
                            <input type="email" id="cust-email" required
                                class="w-full bg-gem-accent border border-gray-700 rounded-sm p-3 text-white focus:outline-none focus:border-gem-gold transition-colors">
                        </div>
                    </div>

                    <div class="p-4 bg-gem-darker border border-gem-accent rounded-sm space-y-3">
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-400">Total Amount</span>
                            <span id="checkout-price" class="text-gem-gold font-bold text-xl">$0</span>
                        </div>
                        <p class="text-[9px] text-gray-500 uppercase tracking-widest leading-relaxed">
                            Simulated Payment Mode: This is a secure demonstration. No actual funds will be transferred
                            during this session.
                        </p>
                    </div>

                    <button type="submit"
                        class="w-full bg-gem-gold text-gem-darker font-bold py-4 rounded-sm hover:bg-yellow-500 transition-all duration-300 uppercase tracking-widest text-xs">
                        Complete Purchase
                    </button>
                </form>

                <div id="success-screen" class="hidden text-center py-10 space-y-6">
                    <div
                        class="w-20 h-20 bg-green-500/20 border border-green-500/50 rounded-full flex items-center justify-center mx-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-green-500" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                    </div>
                    <div>
                        <h2 class="text-3xl font-serif text-white mb-2">Order Confirmed!</h2>
                        <div id="success-items-list" class="text-xs text-gray-500 uppercase tracking-widest mb-4">
                            <!-- Items listed here -->
                        </div>
                        <p class="text-gray-400">Thank you for your purchase. Your order ID is:</p>
                        <div class="mt-4 p-3 bg-gem-accent border border-gem-gold/20 text-gem-gold font-mono text-xl tracking-widest"
                            id="order-id-display">
                            ORD-XXXXXX
                        </div>
                    </div>
                    <p class="text-gray-500 text-xs">
                        You can track your order status using this ID on our <a href="track.html"
                            class="text-gem-gold hover:underline">Track Order</a> page.
                    </p>
                    <button onclick="closeCheckout()"
                        class="text-gem-gold hover:text-white transition-colors text-xs uppercase tracking-widest">
                        Back to Inventory
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Overlay & Drawer -->
    <div id="cart-overlay" onclick="closeCart()"
        class="fixed inset-0 z-[110] bg-black/80 backdrop-blur-sm hidden opacity-0 transition-opacity duration-300">
    </div>
    <div id="cart-drawer"
        class="fixed top-0 right-0 h-full w-full max-w-md bg-gem-dark z-[120] border-l border-gem-accent transform translate-x-full transition-transform duration-300 flex flex-col shadow-2xl">
        <!-- Header -->
        <div class="p-6 border-b border-gray-800 flex justify-between items-center bg-gem-darker">
            <h2 class="text-2xl font-serif text-white flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gem-gold" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                        d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                </svg>
                Your Collection
            </h2>
            <button onclick="closeCart()" class="text-gray-500 hover:text-white transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <!-- Cart Items -->
        <div id="cart-drawer-items" class="flex-grow overflow-y-auto p-6 space-y-4">
            <!-- Items injected by JS -->
        </div>

        <!-- Footer -->
        <div class="p-6 border-t border-gray-800 bg-gem-darker">
            <div class="flex justify-between items-center mb-6">
                <span class="text-gray-400 uppercase tracking-widest text-xs">Subtotal</span>
                <span id="cart-subtotal" class="text-2xl font-serif text-white font-bold">$0</span>
            </div>
            <button onclick="proceedToCheckout()"
                class="w-full bg-gem-gold text-gem-darker font-bold py-4 rounded-sm hover:bg-yellow-500 transition-all duration-300 uppercase tracking-widest text-sm shadow-lg shadow-gem-gold/20">
                Proceed to Checkout
            </button>
            <p class="text-[10px] text-gray-500 text-center mt-4 tracking-tighter uppercase italic">
                Free secure shipping from gemcity to worldwide
            </p>
        </div>
    </div>

    <!-- Inventory Section -->
    <!-- Added pt-32 (padding-top: 8rem = 128px) to account for fixed navbar on desktop -->
    <section id="inventory" class="pt-32 pb-20 bg-gem-darker relative min-h-screen">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16 mt-8">
                <h2 class="text-4xl font-serif font-bold text-white mb-4">Current Inventory</h2>
                <div class="w-24 h-1 bg-gem-gold mx-auto mb-6"></div>
                <p class="text-gray-400 max-w-2xl mx-auto">Explore our exclusive selection of untreated, natural rough
                    stones.</p>
            </div>

            <!-- Filters -->
            <div class="sticky top-20 lg:top-24 z-40 bg-gem-darker/95 backdrop-blur-sm py-4 mb-10 border-b border-gem-accent/50 shadow-2xl"
                id="filter-bar">
                <div class="flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">

                    <!-- Search/Count -->
                    <div class="text-gray-400 text-sm font-medium">
                        Showing <span id="gem-count" class="text-white">0</span> stones
                    </div>

                    <!-- Filter Controls -->
                    <div class="flex flex-wrap justify-center gap-4">
                        <!-- Type Filter -->
                        <div class="relative group">
                            <select id="filter-type"
                                class="appearance-none bg-gem-accent text-white py-2 px-4 pr-8 rounded border border-gray-700 focus:outline-none focus:border-gem-gold cursor-pointer hover:bg-gray-800 transition-colors">
                                <option value="all">All Types</option>
                                <option value="Sapphire">Sapphire</option>
                                <option value="Spinel">Spinel</option>
                                <option value="Garnet">Garnet</option>
                                <option value="Tourmaline">Tourmaline</option>
                            </select>
                            <div
                                class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gem-gold">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>

                        <!-- Color Filter -->
                        <div class="relative group">
                            <select id="filter-color"
                                class="appearance-none bg-gem-accent text-white py-2 px-4 pr-8 rounded border border-gray-700 focus:outline-none focus:border-gem-gold cursor-pointer hover:bg-gray-800 transition-colors">
                                <option value="all">All Colors</option>
                                <option value="Blue">Blue</option>
                                <option value="Pink">Pink</option>
                                <option value="Yellow">Yellow</option>
                                <option value="Red">Red</option>
                                <option value="Green">Green</option>
                                <option value="Purple">Purple</option>
                            </select>
                            <div
                                class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gem-gold">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>

                        <!-- Price Sort (Optional but nice) -->
                        <div class="relative group">
                            <select id="sort-price"
                                class="appearance-none bg-gem-accent text-white py-2 px-4 pr-8 rounded border border-gray-700 focus:outline-none focus:border-gem-gold cursor-pointer hover:bg-gray-800 transition-colors">
                                <option value="default">Sort by</option>
                                <option value="low-high">Price: Low to High</option>
                                <option value="high-low">Price: High to Low</option>
                            </select>
                            <div
                                class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gem-gold">
                                <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Product Grid -->
            <div id="gem-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                <!-- Cards will be injected here by JS -->
            </div>

            <!-- No Results Message -->
            <div id="no-results" class="hidden text-center py-20">
                <p class="text-gray-400 text-lg">No gems found matching your criteria.</p>
                <button onclick="resetFilters()" class="mt-4 text-gem-gold hover:underline">Clear Filters</button>
            </div>

        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-black py-8 border-t border-gem-accent">
        <div class="max-w-7xl mx-auto px-4 text-center text-gray-600 text-sm">
            <p>&copy; 2024 Gem Cabinet. Sri Lanka. All Rights Reserved.</p>
        </div>
    </footer>

    <!-- Load Gem Data -->
    <script src="js/gems.js"></script>
    <script src="js/cart.js"></script>

    <!-- JavaScript Logic -->
    <script>
        // Use the centralized 'gems' array from js/gems.js

        // State
        let currentType = 'all';
        let currentColor = 'all';
        let sortMode = 'default';

        // Elements
        const grid = document.getElementById('gem-grid');
        const countSpan = document.getElementById('gem-count');
        const noResults = document.getElementById('no-results');
        const filterType = document.getElementById('filter-type');
        const filterColor = document.getElementById('filter-color');
        const sortPrice = document.getElementById('sort-price');

        // Render Function
        function renderGems(data) {
            grid.innerHTML = '';
            countSpan.textContent = data.length;

            if (data.length === 0) {
                noResults.classList.remove('hidden');
                return;
            } else {
                noResults.classList.add('hidden');
            }

            data.forEach(gem => {
                const card = document.createElement('div');
                card.className = 'group bg-gem-accent rounded-sm shadow-xl overflow-hidden hover:shadow-2xl hover:shadow-gem-gold/10 transition-all duration-300 border border-gray-800 hover:border-gem-gold/50';

                card.innerHTML = `
                    <div class="relative h-64 overflow-hidden">
                        <img src="${gem.image}" alt="${gem.name}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700">
                        <div class="absolute top-0 right-0 bg-gem-gold text-gem-darker text-xs font-bold px-3 py-1 m-2 uppercase tracking-wide">
                            ${gem.type}
                        </div>
                    </div>
                    <div class="p-6">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-white font-serif text-lg font-bold group-hover:text-gem-gold transition-colors line-clamp-1">${gem.name}</h3>
                        </div>
                        <div class="space-y-2 text-sm text-gray-400 mb-4">
                            <div class="flex justify-between border-b border-gray-700 pb-1">
                                <span>Weight:</span>
                                <span class="text-gray-200">${gem.weight} ct</span>
                            </div>
                            <div class="flex justify-between border-b border-gray-700 pb-1">
                                <span>Origin:</span>
                                <span class="text-gray-200">${gem.origin}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Color:</span>
                                <span class="text-gray-200">${gem.color}</span>
                            </div>
                        </div>
                        <div class="flex justify-between items-center mt-4 pt-4 border-t border-gray-700">
                            <span class="text-2xl font-serif text-gem-gold font-bold">$${gem.price.toLocaleString()}</span>
                            <div class="flex items-center gap-2">
                                <button onclick="toggleLike(${gem.id})" id="like-btn-${gem.id}" class="transition-all duration-300 flex items-center gap-2 group/like focus:outline-none">
                                    <span id="like-count-${gem.id}" class="text-gray-400 group-hover/like:text-gem-gold text-[10px] font-medium transition-colors">${gem.likes}</span>
                                    <svg id="heart-icon-${gem.id}" xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 stroke-gray-400 fill-transparent group-hover/like:stroke-gem-gold transition-all duration-300" viewBox="0 0 24 24" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.092-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
                                    </svg>
                                </button>
                                <button onclick="addToCart(${gem.id})" class="bg-gem-accent border border-gem-gold/20 hover:border-gem-gold text-gem-gold p-2 rounded-sm transition-all duration-300 group/addcart" title="Add to Cart">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                                    </svg>
                                </button>
                                <button onclick="openCheckout(${gem.id})" class="bg-gem-gold hover:bg-yellow-500 text-gem-darker text-[9px] font-bold px-3 py-2 rounded-sm transition-all duration-300 uppercase tracking-widest shadow-lg shadow-gem-gold/10">
                                    Buy Now
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
                updateHeartState(gem.id);
            });
        }

        // Like/Unlike Logic
        function toggleLike(id) {
            const likedGems = JSON.parse(localStorage.getItem('likedGems') || '[]');
            const isLiked = likedGems.includes(id);
            const gem = gems.find(g => g.id === id);

            if (!gem) return;

            if (isLiked) {
                // Unlike
                const index = likedGems.indexOf(id);
                likedGems.splice(index, 1);
                gem.likes--;
            } else {
                // Like
                likedGems.push(id);
                gem.likes++;
            }

            localStorage.setItem('likedGems', JSON.stringify(likedGems));
            renderGems(currentFilteredGems); // Re-render with current filters to keep UI consistent
        }

        // --- Checkout & Order Tracking ---
        let isCartCheckout = false;
        let selectedGemId = null;

        function openCheckout(id = null) {
            isCartCheckout = (id === null);
            selectedGemId = id;

            const nameEl = document.getElementById('checkout-gem-name');
            const priceEl = document.getElementById('checkout-price');
            const summaryEl = document.getElementById('checkout-items-summary');
            const singleInfo = document.getElementById('checkout-single-info');

            summaryEl.innerHTML = '';

            if (isCartCheckout) {
                singleInfo.classList.add('hidden');
                summaryEl.classList.remove('hidden');
                cart.forEach(gem => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'flex justify-between items-center text-[10px] uppercase tracking-widest text-gray-400';
                    itemDiv.innerHTML = `<span>${gem.name}</span> <span class="text-gem-gold">$${gem.price.toLocaleString()}</span>`;
                    summaryEl.appendChild(itemDiv);
                });
                priceEl.textContent = `$${getCartTotal().toLocaleString()}`;
            } else {
                const gem = gems.find(g => g.id === id);
                singleInfo.classList.remove('hidden');
                summaryEl.classList.add('hidden');
                nameEl.textContent = gem.name;
                priceEl.textContent = `$${gem.price.toLocaleString()}`;
            }

            document.getElementById('checkout-modal').classList.remove('hidden');
            setTimeout(() => {
                document.getElementById('checkout-modal').classList.remove('opacity-0');
            }, 10);
            document.body.style.overflow = 'hidden';
        }

        function proceedToCheckout() {
            if (cart.length === 0) {
                alert('Your cart is empty');
                return;
            }
            closeCart();
            openCheckout(null);
        }

        function closeCheckout() {
            document.getElementById('checkout-modal').classList.add('opacity-0');
            setTimeout(() => {
                document.getElementById('checkout-modal').classList.add('hidden');
                document.getElementById('checkout-form').classList.remove('hidden');
                document.getElementById('success-screen').classList.add('hidden');
                document.getElementById('checkout-form').reset();
            }, 300);
            document.body.style.overflow = 'auto';
            selectedGemId = null;
        }

        function handleCheckout(e) {
            e.preventDefault();
            const myOrders = JSON.parse(localStorage.getItem('myOrders') || '[]');
            const orderId = 'ORD-' + Math.random().toString(36).substr(2, 7).toUpperCase();
            const customerName = document.getElementById('cust-name').value;
            const email = document.getElementById('cust-email').value;
            const date = new Date().toISOString().split('T')[0];

            if (isCartCheckout) {
                cart.forEach(gem => {
                    myOrders.push({
                        id: orderId, // Same ID for bulk order
                        customerName,
                        email,
                        gemId: gem.id,
                        gemName: gem.name,
                        amount: gem.price,
                        date,
                        status: 'Payment Received'
                    });
                });
                clearCart();
            } else {
                const gem = gems.find(g => g.id === selectedGemId);
                myOrders.push({
                    id: orderId,
                    customerName,
                    email,
                    gemId: gem.id,
                    gemName: gem.name,
                    amount: gem.price,
                    date,
                    status: 'Payment Received',
                    userEmail: (typeof getCurrentUser === 'function' && getCurrentUser()) ? getCurrentUser().email : null
                });
            }

            localStorage.setItem('myOrders', JSON.stringify(myOrders));

            // UI
            const successList = document.getElementById('success-items-list');
            successList.innerHTML = '';
            if (isCartCheckout) {
                // We cleared the cart already, but we have the items in myOrders or we can use a temp copy
                // Let's use the matching items from myOrders for this orderId
                myOrders.filter(o => o.id === orderId).forEach(o => {
                    const span = document.createElement('span');
                    span.className = 'block';
                    span.textContent = o.gemName;
                    successList.appendChild(span);
                });
            } else {
                const gem = gems.find(g => g.id === selectedGemId);
                successList.textContent = gem.name;
            }

            document.getElementById('checkout-form').classList.add('hidden');
            document.getElementById('success-screen').classList.remove('hidden');
            document.getElementById('order-id-display').textContent = orderId;
        }

        function updateHeartState(id) {
            const likedGems = JSON.parse(localStorage.getItem('likedGems') || '[]');
            const icon = document.getElementById(`heart-icon-${id}`);
            const count = document.getElementById(`like-count-${id}`);

            if (likedGems.includes(id)) {
                icon.classList.remove('stroke-gray-400', 'fill-transparent');
                icon.classList.add('stroke-gem-gold', 'fill-gem-gold');
                count.classList.remove('text-gray-400');
                count.classList.add('text-gem-gold');
            }
        }

        let currentFilteredGems = [...gems];

        function filterAndSortGems() {
            currentFilteredGems = gems.filter(gem => {
                const matchType = currentType === 'all' || gem.type === currentType;
                const matchColor = currentColor === 'all' || gem.color === currentColor;
                return matchType && matchColor;
            });

            if (sortMode === 'low-high') {
                currentFilteredGems.sort((a, b) => a.price - b.price);
            } else if (sortMode === 'high-low') {
                currentFilteredGems.sort((a, b) => b.price - a.price);
            }

            renderGems(currentFilteredGems);
        }

        function resetFilters() {
            currentType = 'all';
            currentColor = 'all';
            sortMode = 'default';
            filterType.value = 'all';
            filterColor.value = 'all';
            sortPrice.value = 'default';
            filterAndSortGems();
        }

        // Event Listeners
        filterType.addEventListener('change', (e) => {
            currentType = e.target.value;
            filterAndSortGems();
        });

        filterColor.addEventListener('change', (e) => {
            currentColor = e.target.value;
            filterAndSortGems();
        });

        sortPrice.addEventListener('change', (e) => {
            sortMode = e.target.value;
            filterAndSortGems();
        });

        // Initial Render
        document.addEventListener('DOMContentLoaded', () => {
            console.log("Gem Cabinet Initialized");
            renderGems(gems);

            // Check if cart should be opened (from other pages)
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('openCart') === 'true') {
                setTimeout(openCart, 500);
            }
        });

    </script>
</body>

</html>